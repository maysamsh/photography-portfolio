(T=>{T.fn.poptrox_disableSelection=function(){return T(this).css("user-select","none").css("-khtml-user-select","none").css("-moz-user-select","none").css("-o-user-select","none").css("-webkit-user-select","none")},T.fn.poptrox=function(e){if(0==this.length)return T(this);if(1<this.length){for(var o=0;o<this.length;o++)T(this[o]).poptrox(e);return T(this)}function s(){t=h.width(),p=h.height()+a.windowHeightPad;var e=Math.abs(r.width()-r.outerWidth()),o=Math.abs(r.height()-r.outerHeight()),e=t-2*a.windowMargin-e,o=p-2*a.windowMargin-o;r.css("min-width",a.popupWidth).css("min-height",a.popupHeight),w.children().css("max-width",e).css("max-height",o)}var t,p,r,i,n,a=T.extend({preload:!1,baseZIndex:1e3,fadeSpeed:300,overlayColor:"#000000",overlayOpacity:.6,overlayClass:"poptrox-overlay",windowMargin:50,windowHeightPad:0,selector:"a",caption:null,parent:"body",popupSpeed:300,popupWidth:200,popupHeight:100,popupIsFixed:!1,useBodyOverflow:!1,usePopupEasyClose:!0,usePopupForceClose:!1,usePopupLoader:!0,usePopupCloser:!0,usePopupCaption:!1,usePopupNav:!1,usePopupDefaultStyling:!0,popupBackgroundColor:"#FFFFFF",popupTextColor:"#000000",popupLoaderTextSize:"2em",popupCloserBackgroundColor:"#000000",popupCloserTextColor:"#FFFFFF",popupCloserTextSize:"20px",popupPadding:10,popupCaptionHeight:60,popupCaptionTextSize:null,popupBlankCaptionText:"(untitled)",popupCloserText:"&#215;",popupLoaderText:"&bull;&bull;&bull;&bull;",popupClass:"poptrox-popup",popupSelector:null,popupLoaderSelector:".loader",popupCloserSelector:".closer",popupCaptionSelector:".caption",popupNavPreviousSelector:".nav-previous",popupNavNextSelector:".nav-next",onPopupClose:null,onPopupOpen:null},e),l=T(this),u=T("body"),d=T('<div class="'+a.overlayClass+'"></div>'),h=T(window),g=[],f=0,x=!1,v=new Array,w=(a.usePopupLoader||(a.popupLoaderSelector=null),a.usePopupCloser||(a.popupCloserSelector=null),a.usePopupCaption||(a.popupCaptionSelector=null),a.usePopupNav||(a.popupNavPreviousSelector=null,a.popupNavNextSelector=null),(r=a.popupSelector?T(a.popupSelector):T('<div class="'+a.popupClass+'">'+(a.popupLoaderSelector?'<div class="loader">'+a.popupLoaderText+"</div>":"")+'<div class="pic"></div>'+(a.popupCaptionSelector?'<div class="caption"></div>':"")+(a.popupCloserSelector?'<span class="closer">'+a.popupCloserText+"</span>":"")+(a.popupNavPreviousSelector?'<div class="nav-previous"></div>':"")+(a.popupNavNextSelector?'<div class="nav-next"></div>':"")+"</div>")).find(".pic")),b=T(),m=r.find(a.popupLoaderSelector),C=r.find(a.popupCaptionSelector),y=r.find(a.popupCloserSelector),S=r.find(a.popupNavNextSelector),P=r.find(a.popupNavPreviousSelector),k=S.add(P);return a.usePopupDefaultStyling&&(r.css("background",a.popupBackgroundColor).css("color",a.popupTextColor).css("padding",a.popupPadding+"px"),0<C.length&&(r.css("padding-bottom",a.popupCaptionHeight+"px"),C.css("position","absolute").css("left","0").css("bottom","0").css("width","100%").css("text-align","center").css("height",a.popupCaptionHeight+"px").css("line-height",a.popupCaptionHeight+"px"),a.popupCaptionTextSize)&&C.css("font-size",popupCaptionTextSize),0<y.length&&y.html(a.popupCloserText).css("font-size",a.popupCloserTextSize).css("background",a.popupCloserBackgroundColor).css("color",a.popupCloserTextColor).css("display","block").css("width","40px").css("height","40px").css("line-height","40px").css("text-align","center").css("position","absolute").css("text-decoration","none").css("outline","0").css("top","0").css("right","-40px"),0<m.length&&m.html("").css("position","relative").css("font-size",a.popupLoaderTextSize).on("startSpinning",function(e){var o=T("<div>"+a.popupLoaderText+"</div>");o.css("height",Math.floor(a.popupHeight/2)+"px").css("overflow","hidden").css("line-height",Math.floor(a.popupHeight/2)+"px").css("text-align","center").css("margin-top",Math.floor((r.height()-o.height()+(0<C.length?C.height():0))/2)).css("color",a.popupTextColor||"").on("xfin",function(){o.fadeTo(300,.5,function(){o.trigger("xfout")})}).on("xfout",function(){o.fadeTo(300,.05,function(){o.trigger("xfin")})}).trigger("xfin"),m.append(o)}).on("stopSpinning",function(e){m.find("div").remove()}),2==k.length)&&(k.css("font-size","75px").css("text-align","center").css("color","#fff").css("text-shadow","none").css("height","100%").css("position","absolute").css("top","0").css("opacity","0.35").css("cursor","pointer").css("box-shadow","inset 0px 0px 10px 0px rgba(0,0,0,0)").poptrox_disableSelection(),n=a.usePopupEasyClose?i="100px":(i="75%","25%"),S.css("right","0").css("width",i).html('<div style="position: absolute; height: 100px; width: 125px; top: 50%; right: 0; margin-top: -50px;">&gt;</div>'),P.css("left","0").css("width",n).html('<div style="position: absolute; height: 100px; width: 125px; top: 50%; left: 0; margin-top: -50px;">&lt;</div>')),h.on("resize orientationchange",function(){s()}),C.on("update",function(e,o){o&&0!=o.length||(o=a.popupBlankCaptionText),C.html(o)}),y.css("cursor","pointer").on("click",function(e){return e.preventDefault(),e.stopPropagation(),r.trigger("poptrox_close"),!0}),S.on("click",function(e){e.stopPropagation(),e.preventDefault(),r.trigger("poptrox_next")}),P.on("click",function(e){e.stopPropagation(),e.preventDefault(),r.trigger("poptrox_previous")}),d.css("position","fixed").css("left",0).css("top",0).css("z-index",a.baseZIndex).css("width","100%").css("height","100%").css("text-align","center").css("cursor","pointer").appendTo(a.parent).prepend('<div style="display:inline-block;height:100%;vertical-align:middle;"></div>').append('<div style="position:absolute;left:0;top:0;width:100%;height:100%;background:'+a.overlayColor+";opacity:"+a.overlayOpacity+";filter:alpha(opacity="+100*a.overlayOpacity+');"></div>').hide().on("touchmove",function(e){return!1}).on("click",function(e){e.preventDefault(),e.stopPropagation(),r.trigger("poptrox_close")}),r.css("display","inline-block").css("vertical-align","middle").css("position","relative").css("z-index",1).css("cursor","auto").appendTo(d).hide().on("poptrox_next",function(){var e=f+1;e>=g.length&&(e=0),r.trigger("poptrox_switch",[e])}).on("poptrox_previous",function(){var e=f-1;e<0&&(e=g.length-1),r.trigger("poptrox_switch",[e])}).on("poptrox_reset",function(){s(),r.data("width",a.popupWidth).data("height",a.popupHeight),m.hide().trigger("stopSpinning"),C.hide(),y.hide(),k.hide(),w.hide(),b.attr("src","").detach()}).on("poptrox_open",function(e,o){if(x)return!0;x=!0,a.useBodyOverflow&&u.css("overflow","hidden"),a.onPopupOpen&&a.onPopupOpen(),r.addClass("loading"),d.fadeTo(a.fadeSpeed,1,function(){r.trigger("poptrox_switch",[o,!0])})}).on("poptrox_switch",function(e,p,o){var i,t;if(!o&&x)return!0;x=!0,r.addClass("loading").css("width",r.data("width")).css("height",r.data("height")),C.hide(),b.attr("src")&&b.attr("src",""),b.detach(),i=g[p],(b=i.object).off("load"),w.css("text-indent","-9999px").show().append(b),"ajax"==i.type?T.get(i.src,function(e){b.html(e),b.trigger("load")}):b.attr("src",i.src),"image"!=i.type&&(o=i.width,t=i.height,"%"==o.slice(-1)&&(o=parseInt(o.substring(0,o.length-1))/100*h.width()),"%"==t.slice(-1)&&(t=parseInt(t.substring(0,t.length-1))/100*h.height()),b.css("position","relative").css("outline","0").css("z-index",a.baseZIndex+100).width(o).height(t)),m.trigger("startSpinning").fadeIn(300),r.show(),a.popupIsFixed?(r.removeClass("loading").width(a.popupWidth).height(a.popupHeight),b.on("load",function(){b.off("load"),m.hide().trigger("stopSpinning"),C.trigger("update",[i.captionText]).fadeIn(a.fadeSpeed),y.fadeIn(a.fadeSpeed),w.css("text-indent",0).hide().fadeIn(a.fadeSpeed,function(){x=!1}),f=p,k.fadeIn(a.fadeSpeed)})):b.on("load",function(){s(),b.off("load"),m.hide().trigger("stopSpinning");function e(){C.trigger("update",[i.captionText]).fadeIn(a.fadeSpeed),y.fadeIn(a.fadeSpeed),w.css("text-indent",0).hide().fadeIn(a.fadeSpeed,function(){x=!1}),f=p,k.fadeIn(a.fadeSpeed),r.removeClass("loading").data("width",o).data("height",t).css("width","auto").css("height","auto")}var o=b.width(),t=b.height();o==r.data("width")&&t==r.data("height")?e():r.animate({width:o,height:t},a.popupSpeed,"swing",e)}),"image"!=i.type&&b.trigger("load")}).on("poptrox_close",function(){if(x&&!a.usePopupForceClose)return!0;x=!0,r.hide().trigger("poptrox_reset"),a.onPopupClose&&a.onPopupClose(),d.fadeOut(a.fadeSpeed,function(){a.useBodyOverflow&&u.css("overflow","auto"),x=!1})}).trigger("poptrox_reset"),a.usePopupEasyClose?(C.on("click","a",function(e){e.stopPropagation()}),r.css("cursor","pointer").on("click",function(e){e.stopPropagation(),e.preventDefault(),r.trigger("poptrox_close")})):r.on("click",function(e){e.stopPropagation()}),h.keydown(function(e){if(r.is(":visible"))switch(e.keyCode){case 37:case 32:if(a.usePopupNav)return r.trigger("poptrox_previous"),!1;break;case 39:if(a.usePopupNav)return r.trigger("poptrox_next"),!1;break;case 27:return r.trigger("poptrox_close"),!1}}),l.find(a.selector).each(function(o){var e=T(this),t=e.find("img"),p=e.data("poptrox");if("ignore"!=p&&e.attr("href")){var i,s,n={src:e.attr("href"),captionText:t.attr("title"),width:null,height:null,type:null,object:null,options:null};if(a.caption?"function"==typeof a.caption?c=a.caption(e):"selector"in a.caption&&(i=e.find(a.caption.selector),"attribute"in a.caption?c=i.attr(a.caption.attribute):(c=i.html(),!0===a.caption.remove&&i.remove())):c=t.attr("title"),n.captionText=c,p&&(0 in(i=p.split(","))&&(n.type=i[0]),1 in i&&(s=i[1].match(/([0-9%]+)x([0-9%]+)/))&&3==s.length&&(n.width=s[1],n.height=s[2]),2 in i)&&(n.options=i[2]),!n.type)switch((s=!(s=n.src.match(/\/\/([a-z0-9\.]+)\/.*/))||s.length<2?[!1]:s)[1]){case"api.soundcloud.com":n.type="soundcloud";break;case"youtu.be":n.type="youtube";break;case"vimeo.com":n.type="vimeo";break;case"wistia.net":n.type="wistia";break;case"bcove.me":n.type="bcove";break;default:n.type="image"}switch(s=n.src.match(/\/\/[a-z0-9\.]+\/(.*)/),n.type){case"iframe":n.object=T('<iframe src="" frameborder="0"></iframe>'),n.object.on("click",function(e){e.stopPropagation()}).css("cursor","auto"),n.width&&n.height||(n.width="600",n.height="400");break;case"ajax":n.object=T('<div class="poptrox-ajax"></div>'),n.object.on("click",function(e){e.stopPropagation()}).css("cursor","auto").css("overflow","auto"),n.width&&n.height||(n.width="600",n.height="400");break;case"soundcloud":n.object=T('<iframe scrolling="no" frameborder="no" src=""></iframe>'),n.src="//w.soundcloud.com/player/?url="+escape(n.src)+(n.options?"&"+n.options:""),n.width="600",n.height="166";break;case"youtube":n.object=T('<iframe src="" frameborder="0" allowfullscreen="1"></iframe>'),n.src="//www.youtube.com/embed/"+s[1]+(n.options?"?"+n.options:""),n.width&&n.height||(n.width="800",n.height="480");break;case"vimeo":n.object=T('<iframe src="" frameborder="0" allowFullScreen="1"></iframe>'),n.src="//player.vimeo.com/video/"+s[1]+(n.options?"?"+n.options:""),n.width&&n.height||(n.width="800",n.height="480");break;case"wistia":n.object=T('<iframe src="" frameborder="0" allowFullScreen="1"></iframe>'),n.src="//fast.wistia.net/"+s[1]+(n.options?"?"+n.options:""),n.width&&n.height||(n.width="800",n.height="480");break;case"bcove":n.object=T('<iframe src="" frameborder="0" allowFullScreen="1" width="100%"></iframe>'),n.src="//bcove.me/"+s[1]+(n.options?"?"+n.options:""),n.width&&n.height||(n.width="640",n.height="360");break;default:n.object=T('<img src="" alt="" style="vertical-align:bottom" />'),a.preload&&((s=document.createElement("img")).src=n.src,v.push(s)),n.width=e.attr("width"),n.height=e.attr("height")}"file:"==window.location.protocol&&n.src.match(/^\/\//)&&(n.src="http:"+n.src),g.push(n),t.removeAttr("title"),e.removeAttr("href").css("cursor","pointer").css("outline",0).on("click",function(e){e.preventDefault(),e.stopPropagation(),r.trigger("poptrox_open",[o])})}}),l.prop("_poptrox",a),l}})(jQuery);